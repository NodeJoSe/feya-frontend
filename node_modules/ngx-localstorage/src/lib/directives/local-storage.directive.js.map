{"version":3,"sources":["local-storage.directive.ts"],"names":[],"mappings":"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","file":"local-storage.directive.js","sourceRoot":"","sourcesContent":["/**\r\n * Created by bohoffi on 03.04.2017.\r\n */\r\nimport {AfterViewInit, Directive, ElementRef, EventEmitter, Input, OnDestroy, Output} from '@angular/core';\r\nimport {Observable} from 'rxjs/Observable';\r\nimport {Subscription} from 'rxjs/Subscription';\r\n\r\nimport 'rxjs/add/observable/fromEvent';\r\nimport 'rxjs/add/operator/debounceTime';\r\n\r\nimport {LocalStorageService} from '../services/index';\r\nimport {getProperty, setProperty} from '../utils';\r\n\r\n\r\nexport class LocalStorageDirective implements AfterViewInit, OnDestroy {\r\n\r\n    \r\n    lsKey: string;\r\n    \r\n    lsPrefix: string;\r\n    \r\n    lsEvent: string;\r\n    \r\n    lsDebounce = 0;\r\n    \r\n    lsInitFromStorage = false;\r\n\r\n    \r\n    lsStoredValue = new EventEmitter<any>();\r\n\r\n    private _eventSubscription: Subscription;\r\n    private _valuePath: Array<any> = [];\r\n\r\n    constructor(private _element: ElementRef,\r\n                private _service: LocalStorageService) {\r\n    }\r\n\r\n    ngAfterViewInit(): void {\r\n        this._initKey();\r\n        this._initFromStorage();\r\n        this._hookEvent();\r\n    }\r\n\r\n    \r\n    set lsValuePath(path: any[] | string) {\r\n        if (path != null) {\r\n            this._valuePath = Array.isArray(path) ? path : path.split(',');\r\n        } else {\r\n            this._valuePath = [];\r\n        }\r\n    }\r\n\r\n    private _initKey(): void {\r\n        if (!this.lsKey) {\r\n            if (!this._element.nativeElement.id && !this._element.nativeElement.name) {\r\n                throw new Error('No key or element id or name supplied!');\r\n            }\r\n            this.lsKey = this._element.nativeElement.id || this._element.nativeElement.name;\r\n        }\r\n    }\r\n\r\n    private _hookEvent(): void {\r\n        if (this.lsEvent) {\r\n            this._eventSubscription = Observable.fromEvent(this._element.nativeElement, this.lsEvent)\r\n                .debounceTime(this.lsDebounce)\r\n                .subscribe(() => {\r\n                    this._service.asPromisable().set(this.lsKey,\r\n                        getProperty(this._valuePath.length ? this._valuePath : ['value'], this._element.nativeElement),\r\n                        this.lsPrefix)\r\n                        .then(() => {\r\n                            this._service.asPromisable().get(this.lsKey, this.lsPrefix)\r\n                                .then((value: any) => {\r\n                                    this.lsStoredValue.emit(value);\r\n                                })\r\n                                .catch((err: Error) => console.error(err));\r\n                        })\r\n                        .catch((err: Error) => console.error(err));\r\n                });\r\n        }\r\n    }\r\n\r\n    private _initFromStorage(): void {\r\n        if (this.lsInitFromStorage) {\r\n            this._service.asPromisable().get(this.lsKey, this.lsPrefix)\r\n                .then((storedValue: any) => {\r\n                    if (!!storedValue && typeof storedValue === 'string' && storedValue !== 'null') {\r\n                        setProperty(this._valuePath.length ? this._valuePath : ['value'], storedValue, this._element.nativeElement);\r\n                    }\r\n                })\r\n                .catch((err: Error) => console.error(err));\r\n        }\r\n    }\r\n\r\n    ngOnDestroy(): void {\r\n        if (this._eventSubscription && !this._eventSubscription.closed) {\r\n            this._eventSubscription.unsubscribe();\r\n        }\r\n    }\r\nstatic decorators: DecoratorInvocation[] = [\n{ type: Directive, args: [{\r\n    selector: '[ngxLocalStorage]'\r\n}, ] },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ElementRef, },\n{type: LocalStorageService, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'lsKey': [{ type: Input, args: ['ngxLocalStorage', ] },],\n'lsPrefix': [{ type: Input },],\n'lsEvent': [{ type: Input },],\n'lsDebounce': [{ type: Input },],\n'lsInitFromStorage': [{ type: Input },],\n'lsStoredValue': [{ type: Output },],\n'lsValuePath': [{ type: Input },],\n};\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}