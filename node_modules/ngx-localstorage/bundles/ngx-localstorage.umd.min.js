!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("rxjs/Observable"),require("rxjs/add/observable/fromEvent"),require("rxjs/add/operator/debounceTime")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","rxjs/Observable","rxjs/add/observable/fromEvent","rxjs/add/operator/debounceTime"],t):t((e.ng=e.ng||{},e.ng.localstorage=e.ng.localstorage||{}),e.ng.core,e.ng.common,e.Rx)}(this,function(e,t,r,o){"use strict";function n(e){return function(t,r){var o=new c({prefix:e&&e.prefix?e.prefix:""}),n=e&&e.key?e.key:r;Object.defineProperty(t,r,{get:function(){return o.get(n)},set:function(e){o.set(n,e)}})}}function i(e){return new c(e)}var l=function(){function e(e){this._prefix="ngx_local_storage",this._allowNull=!0,e&&(this._prefix=e.prefix||this._prefix,this._allowNull=e.allowNull||this._allowNull)}return e.prototype.count=function(){return new Promise(function(e,t){try{e(localStorage.length)}catch(e){t(e)}})},e.prototype.getKey=function(e){return new Promise(function(t,r){e<0&&r(new Error("index has to be 0 or greater"));try{t(localStorage.key(e))}catch(e){r(e)}})},e.prototype.set=function(e,t,r){var o=this;return new Promise(function(n,i){try{if(!o._allowNull&&(o._allowNull||"null"===t||null===t||void 0===t))return o.remove(e,r);localStorage.setItem((r||o._prefix)+"_"+e,t),n(!0)}catch(e){i(e)}})},e.prototype.get=function(e,t){var r=this;return new Promise(function(o,n){try{o(localStorage.getItem((t||r._prefix)+"_"+e))}catch(e){n(e)}})},e.prototype.remove=function(e,t){var r=this;return new Promise(function(o,n){try{localStorage.removeItem((t||r._prefix)+"_"+e),o(!0)}catch(e){n(e)}})},e.prototype.clear=function(){return new Promise(function(e,t){try{localStorage.clear(),e(!0)}catch(e){t(e)}})},e}(),a=function(e,t){return e.reduce(function(e,t){return e&&e[t]?e[t]:null},t)},s=function(e,t,r){for(var o=e.length-1,n=0;n<o;++n){var i=e[n];i in r||(r[i]={}),r=r[i]}r[e[o]]=t},u={allowNull:!0,prefix:"ngx_local_storage"},c=function(){function e(e){e&&(this._prefix=e.prefix||u.prefix,this._allowNull=e.allowNull||u.allowNull),this._promisable=new l({allowNull:this._allowNull,prefix:this._prefix})}return e.prototype.asPromisable=function(){return this._promisable},e.prototype.count=function(){try{return localStorage.length}catch(e){console.error(e)}},e.prototype.getKey=function(e){e<0&&console.error(new Error("index has to be 0 or greater"));try{return localStorage.key(e)}catch(e){console.error(e)}},e.prototype.set=function(e,t,r){this._allowNull||!this._allowNull&&"null"!==t&&null!==t&&void 0!==t?localStorage.setItem((r||this._prefix)+"_"+e,t):this.remove(e,r)},e.prototype.get=function(e,t){try{return localStorage.getItem((t||this._prefix)+"_"+e)}catch(e){console.error(e)}},e.prototype.remove=function(e,t){try{localStorage.removeItem((t||this._prefix)+"_"+e)}catch(e){console.error(e)}},e.prototype.clear=function(){try{localStorage.clear()}catch(e){console.error(e)}},e}();c.decorators=[{type:t.Injectable}],c.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Optional}]}]};var p=function(){function e(e,r){this._element=e,this._service=r,this.lsDebounce=0,this.lsInitFromStorage=!1,this.lsStoredValue=new t.EventEmitter,this._valuePath=[]}return e.prototype.ngAfterViewInit=function(){this._initKey(),this._initFromStorage(),this._hookEvent()},Object.defineProperty(e.prototype,"lsValuePath",{set:function(e){this._valuePath=null!=e?Array.isArray(e)?e:e.split(","):[]},enumerable:!0,configurable:!0}),e.prototype._initKey=function(){if(!this.lsKey){if(!this._element.nativeElement.id&&!this._element.nativeElement.name)throw new Error("No key or element id or name supplied!");this.lsKey=this._element.nativeElement.id||this._element.nativeElement.name}},e.prototype._hookEvent=function(){var e=this;this.lsEvent&&(this._eventSubscription=o.Observable.fromEvent(this._element.nativeElement,this.lsEvent).debounceTime(this.lsDebounce).subscribe(function(){e._service.asPromisable().set(e.lsKey,a(e._valuePath.length?e._valuePath:["value"],e._element.nativeElement),e.lsPrefix).then(function(){e._service.asPromisable().get(e.lsKey,e.lsPrefix).then(function(t){e.lsStoredValue.emit(t)}).catch(function(e){return console.error(e)})}).catch(function(e){return console.error(e)})}))},e.prototype._initFromStorage=function(){var e=this;this.lsInitFromStorage&&this._service.asPromisable().get(this.lsKey,this.lsPrefix).then(function(t){t&&"string"==typeof t&&"null"!==t&&s(e._valuePath.length?e._valuePath:["value"],t,e._element.nativeElement)}).catch(function(e){return console.error(e)})},e.prototype.ngOnDestroy=function(){this._eventSubscription&&!this._eventSubscription.closed&&this._eventSubscription.unsubscribe()},e}();p.decorators=[{type:t.Directive,args:[{selector:"[ngxLocalStorage]"}]}],p.ctorParameters=function(){return[{type:t.ElementRef},{type:c}]},p.propDecorators={lsKey:[{type:t.Input,args:["ngxLocalStorage"]}],lsPrefix:[{type:t.Input}],lsEvent:[{type:t.Input}],lsDebounce:[{type:t.Input}],lsInitFromStorage:[{type:t.Input}],lsStoredValue:[{type:t.Output}],lsValuePath:[{type:t.Input}]};var f=new t.InjectionToken("moduleConfig"),h=function(){function e(e){if(e)throw new Error("NgxLocalStorageModule is already loaded. Import it in the AppModule only")}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:f,useValue:t},{provide:c,useFactory:i,deps:[f]}]}},e}();h.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule],declarations:[p],exports:[p]}]}],h.ctorParameters=function(){return[{type:h,decorators:[{type:t.Optional},{type:t.SkipSelf}]}]},e.ModuleConfigToken=f,e.provideStorageService=i,e.NgxLocalStorageModule=h,e.LocalStorageService=c,e.ngxLocalStorage=n,Object.defineProperty(e,"__esModule",{value:!0})});